<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.emos.api.db.dao.TbAmectTypeDao">
    <insert id="insert">
        INSERT INTO tb_amect_type
        SET type = #{type},
            money = #{money},
            systemic = false
    </insert>
    <update id="update" parameterType="hashmap">
        UPDATE tb_amect_type
        SET type = #{type},
            money = #{money}
        WHERE id = #{id}
    </update>
    <delete id="deleteByIds">
        DELETE FROM tb_amect_type
        WHERE systemic = false AND id IN
        <foreach collection="array" open="(" separator="," close=")" item="one">
            #{one}
        </foreach>
    </delete>
    <select id="searchAllAmectType" resultType="com.example.emos.api.db.pojo.TbAmectType">
        SELECT id,
               type,
               money,
               systemic
        FROM tb_amect_type
    </select>
    <select id="searchAmectTypePage" parameterType="hashmap" resultType="java.util.HashMap">
        SELECT `at`.id,
               `at`.type,
               `at`.money,
               `at`.systemic,
               COUNT(a.type_id) AS notPay,
               IF(COUNT(a.id)=0 AND systemic=false,"true","false") AS canDelete
        FROM tb_amect_type `at`
        LEFT JOIN tb_amect a ON `at`.id = a.type_id AND a.`status` = 1
        WHERE 1=1
        <if test="type!=null">
            AND `at`.type LIKE '%${type}%'
        </if>
        GROUP BY `at`.id
        LIMIT #{start},#{length}
    </select>
    <select id="searchAmectTypeCount" parameterType="hashmap"  resultType="java.lang.Long">
        SELECT COUNT(temp.ct)
        FROM (
            SELECT COUNT(*) AS ct
            FROM tb_amect_type `at`
            LEFT JOIN tb_amect a ON `at`.id = a.type_id AND a.`status` = 1
            WHERE 1=1
            <if test="type!=null">
                AND `at`.type LIKE '%${type}%'
            </if>
            GROUP BY `at`.id
            ) temp
    </select>
    <select id="searchById" parameterType="hashmap" resultType="java.util.HashMap">
        SELECT `type`,
               money,
               systemic
        FROM tb_amect_type
        WHERE id = #{id}
    </select>
</mapper>